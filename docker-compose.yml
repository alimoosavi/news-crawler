version: "3.9"

services:
  # ============================================================================
  # SELENIUM CHROME (Collector-Specific)
  # ============================================================================
  chrome:
    image: selenium/standalone-chrome:4.15.0
    container_name: news-collector-chrome
    restart: unless-stopped
    ports:
      - "${SE_PORT}:4444"
    shm_size: "512m"
    environment:
      - SE_NODE_MAX_SESSIONS=${SE_NODE_MAX_SESSIONS}
      - SE_NODE_SESSION_TIMEOUT=${SE_NODE_SESSION_TIMEOUT}
    networks:
      - collector_network
      - news_shared_network

  # ============================================================================
  # POSTGRES BACKLOG (Collector-Specific - Temporary Storage)
  # ============================================================================
  news_backlog:
    image: postgres:${POSTGRES_VERSION:-15}
    container_name: news-collector-backlog
    restart: always
    environment:
      POSTGRES_DB: ${POSTGRES_BACKLOG_DB}
      POSTGRES_USER: ${POSTGRES_BACKLOG_USER}
      POSTGRES_PASSWORD: ${POSTGRES_BACKLOG_PASSWORD}
    ports:
      - "${POSTGRES_BACKLOG_PORT:-5434}:5432"
    volumes:
      - news_backlog_data:/var/lib/postgresql/data
    networks:
      - collector_network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_BACKLOG_USER}"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  news_backlog_data:

networks:
  collector_network:
    driver: bridge

  # Connect to shared infrastructure network
  news_shared_network:
    external: true
